function Tablefy(e,t){this._options=t||{showElemet:10,showSearch:!0,showEdit:!0,showDelete:!0,showAdd:!0};var n=function(e){return typeof HTMLElement=="object"?e instanceof HTMLElement:e&&typeof e=="object"&&e!==null&&e.nodeType===1&&typeof e.nodeName=="string"};this._element=n(e)?e:document.getElementById(e),this._itemSelected,this._pagination=!1,this._status="free",this._listener=[],this._buttonEditListener=[],this._buttonAddListener=[],this._buttonRemoveListener=[],this._data=[],this._dataSource=[],this._pages={},this._pages[1]=[];var r=0,i=1,s;Object.defineProperties(this,{length:{get:function(){return r},set:function(e){e.length&&(r=e.length)}},pages:{get:function(){return Object.keys(this._pages).length},set:function(e){}},item:{get:function(){var e=[];if(this._itemSelected){var t=this._itemSelected.children;for(var n=0;n<t.length;n++)e.push(t[n].innerHTML)}return e},set:function(e){}}}),this._currentPage=1,this._nav=document.createElement("nav");var o=document.createElement("ul");o.className="pagination pull-right pagination-sm",this._nav.appendChild(o),o.addEventListener("click",function(e){e.preventDefault();var t=parseInt(e.target.getAttribute("data-page"));if(!isNaN(t)){var n=this.getElementsByClassName("active");for(var r=0;r<n.length;r++)n[r].className="";u._currentPage=t;var i=e.target.getAttribute("data-direction");i=="next"?u._showPagination(t,t+9,this,i):i=="previus"?u._showPagination(t-9,t,this,i):e.target.parentNode.className="active",u._tbody.innerHTML="",u._showPage(t)}});var u=this,a=this._element.getElementsByTagName("tr")[0],f=this._element.getElementsByTagName("th");this._colums=[];for(var l=0;l<f.length;l++)this._colums.push(f[l].innerHTML);a.innerHTML="";var u=this;for(var c in this._colums){var h=document.createElement("span");h.className="glyphicon glyphicon-sort",h.setAttribute("aria-hidden","true"),h.style.marginLeft="0.9em",h.style.marginTop="0.1em",h.style.float="left",h.setAttribute("data-columns",c);var p=document.createElement("th");p.setAttribute("data-columns",c),p.setAttribute("data-order","asc"),p.style.cursor="pointer";var d=document.createElement("span");d.setAttribute("data-columns",c),d.style.float="left",d.innerHTML=this._colums[c]+" ",p.appendChild(d),p.appendChild(h),p.addEventListener("click",function(e){if(u._status=="free"){var t=this.getAttribute("data-columns"),n=this.getAttribute("data-order");u._itemSelected="undefined",u.sort(n,t),u._fixIconSort(),n=="asc"?(this.setAttribute("data-order","desc"),this.children[1].className="glyphicon glyphicon-sort-by-attributes"):n=="desc"&&(this.setAttribute("data-order","asc"),this.children[1].className="glyphicon glyphicon-sort-by-attributes-alt"),this.children[1].style.color="#ff1a00"}}),a.appendChild(p)}this._tbody=document.createElement("tbody"),this._tbody.addEventListener("click",function(e){e.preventDefault();if(u._status=="free"){var t=this.getElementsByTagName("tr");for(var n=0;n<t.length;n++)e.target.parentNode!==t[n]&&(t[n].style.backgroundColor="",t[n].setAttribute("data-select","false"));u._itemSelected="undefined",e.target.parentNode.getAttribute("data-select")=="true"?(e.target.parentNode.style.backgroundColor="",e.target.parentNode.setAttribute("data-select","false"),u._buttonStyle(u._buttonDelete,"disabled"),u._buttonStyle(u._buttonEdit,"disabled")):(u._itemSelected=e.target.parentNode,e.target.parentNode.style.backgroundColor="antiquewhite",e.target.parentNode.setAttribute("data-select","true"),u._buttonStyle(u._buttonDelete,"enabled"),u._buttonStyle(u._buttonEdit,"enabled"))}}),this.maxElement=this._options.showElemet?this._options.showElemet:10,this._element.appendChild(this._tbody);var v=document.createElement("div");v.innerHTML='<div class="row"><div id="control" class="col-sm-4 col-md-5 col-lg-5"></div> <div class="col-sm-2 col-md-3 col-lg-3"> </div><div class="col-sm-6 col-md-4 col-lg-4"> <div class="input-group"><input type="text" class="form-control nobr" placeholder="Search for..."><span class="input-group-btn"><button disabled="true"  class="btn btn-default nobr" type="button"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button></span></div>',this._showSearch=v.getElementsByTagName("input")[0],this._options.showSearch?this._showSearch.addEventListener("keydown",function(e){var t=this;setTimeout(function(){u._sarch(t.value)},180)}):this._showSearch.parentNode.parentNode.innerHTML="",this._buttonDelete,this._options.showDelete&&(this._buttonDelete=document.createElement("button"),this._buttonDelete.className="btn btn-danger",this._buttonDelete.setAttribute("disabled","true"),this._buttonDelete.innerHTML='<span class="glyphicon glyphicon-trash"></span> Delete',v.children[0].children[0].appendChild(this._buttonDelete),this._container=document.createElement("td"),this._container.innerHTML='<div style="cursor:pointer; float:left; width:50%; background:#FF5722; line-height: 2em; text-align: center;font-size: 1.6em;color: white;"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></div><div style="cursor:pointer; float:left; width:50%; background:#CCC; line-height: 2em; text-align: center;font-size: 2em;color: white;"><span class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span></div>',this._container.style.padding=0,this._container.style.margin=0,this._container.activate=function(e){if(e){u._nav.style.visibility="visible",u._buttonStyle(u._showSearch,"enabled"),u._buttonStyle(u._addButton,"enabled"),u._status="free";for(var t=0;t<u._tbody.children.length;t++)u._tbody.children[t]!==u._container&&(u._tbody.children[t].style.opacity="1",u._tbody.children[t].style.backgroundColor="",u._tbody.children[t].style.cursor="pointer")}},this._setDeleteButton()),this._addButton,this._options.showAdd&&(this._addButton=document.createElement("button"),this._addButton.className="btn btn-success",this._addButton.style.marginLeft="0.5em",this._addButton.innerHTML='<span class="glyphicon glyphicon-plus"></span> Add',v.children[0].children[0].appendChild(this._addButton),this._addButton._status="Add",this._addButton._values=[],this._setAddButton()),this._buttonEdit,this._options.showEdit&&(this._buttonEdit=document.createElement("button"),this._buttonEdit.className="btn btn-warning",this._buttonEdit.style.marginLeft="0.5em",this._buttonEdit.setAttribute("disabled","true"),this._buttonEdit.innerHTML='<span class="glyphicon glyphicon-edit"></span> Edit',v.children[0].children[0].appendChild(this._buttonEdit),this._buttonEdit._status="Edit",this._buttonEdit._values=[],this._setEditButton()),this._element.parentNode.insertBefore(v,this._element),this._options.ajax&&this.ajax(function(e){u.setDataTable(JSON.parse(e))},this._options.ajax)}Tablefy.prototype._setEditButton=function(){var e=this;this._buttonEdit.addEventListener("click",function(t){var n=e._itemSelected.children,r=e._itemSelected.parentNode;if(this._status=="Edit"){this.innerHTML='<span class="glyphicon glyphicon-save"></span> Save',this._status="Save",e._status="busy",e._buttonStyle(e._buttonDelete,"disabled"),e._buttonStyle(e._addButton,"disabled"),e._buttonStyle(e._showSearch,"disabled"),e._nav.style.visibility="hidden";var i;for(var s=0;s<r.children.length;s++)r.children[s]!=e._itemSelected&&(r.children[s].style.opacity="0.4",r.children[s].style.backgroundColor="#F4F4F4",r.children[s].style.cursor="none");this._values=[];for(var s=0;s<n.length;s++){var o=n[s].innerHTML;this._values.push(o),n[s].innerHTML="",i=document.createElement("input"),i.className="form-control input-sm",i.setAttribute("type","text"),i.setAttribute("name",e._colums[s].trim()),i.setAttribute("placeholder",o),i.value=o,n[s].appendChild(i)}}else if(this._status=="Save"){this.innerHTML='<span class="glyphicon glyphicon-edit"></span> Edit',this._status="Edit",e._status="free",e._nav.style.visibility="visible",e._buttonStyle(e._buttonDelete,"enabled"),e._buttonStyle(e._addButton,"enabled"),e._buttonStyle(e._showSearch,"enabled");for(var s=0;s<r.children.length;s++)r.children[s]!=e._itemSelected&&(r.children[s].style.opacity="1",r.children[s].style.backgroundColor="",r.children[s].style.cursor="pointer");this._values=[];var u=[];for(var s=0;s<n.length;s++)this._values.push(n[s].children[0].value),u.push(n[s].children[0].getAttribute("placeholder")),n[s].innerHTML=this._values[s];var a=u.join(" ").trim();for(var s in e._dataSource){var f=e._dataSource[s].join(" ").trim();if(f==a){e._dataSource[s]=this._values;break}}var l=-1;for(var s in e._pages[e._currentPage]){var f=e._pages[e._currentPage][s].join(" ").trim();if(f==a){l=s;break}}e._pages[e._currentPage][l]=this._values;var c={};c.prev=u,c.current=this._values;for(var s=0;s<e._buttonEditListener.length;s++)e._buttonEditListener[s](c)}})},Tablefy.prototype._setAddButton=function(){var e=this;this._addButton.addEventListener("click",function(t){if(this._status=="Add"){this._status="Save",e._status="busy",this.innerHTML='<span class="glyphicon glyphicon-save"></span> '+this._status,e._nav.style.visibility="hidden",e._buttonStyle(e._buttonEdit,"disabled"),e._buttonStyle(e._buttonDelete,"disabled"),e._buttonStyle(e._showSearch,"disabled"),e._itemSelected="undefined";for(var n=0;n<e._tbody.children.length;n++)e._tbody.children[n].style.opacity="0.4",e._tbody.children[n].style.backgroundColor="#F4F4F4",e._tbody.children[n].style.cursor="none",e._tbody.children[n].setAttribute("data-select","false");var r=document.createElement("tr");r.style.cursor="pointer",r.style.backgroundColor="#92C5E4";var i;for(var n=0;n<e._colums.length;n++)i=document.createElement("td"),s=document.createElement("input"),s.className="form-control input-sm",s.setAttribute("type","text"),s.setAttribute("name",e._colums[n].trim()),s.setAttribute("placeholder","Insert "+e._colums[n].trim()),i.appendChild(s),r.appendChild(i);e._tbody.insertBefore(r,e._tbody.children[0])}else if(this._status=="Save"){this._status="Add",e._status="free",this.innerHTML='<span class="glyphicon glyphicon-plus"></span> '+this._status,e._nav.style.visibility="visible",e._buttonStyle(e._showSearch,"enabled");var i=e._tbody.children[0].getElementsByTagName("td"),s=[];for(var n=0;n<i.length;n++)i[n].children[0].value.trim()!=""&&s.push(i[n].children[0].value),i[n].innerHTML=i[n].children[0].value;for(var n=0;n<e._tbody.children.length;n++)e._tbody.children[n].style.opacity="1",e._tbody.children[n].style.backgroundColor="",e._tbody.children[n].style.cursor="pointer";s.length!=0?e.addRow(s,!1):e._tbody.removeChild(e._tbody.children[0])}})},Tablefy.prototype._setDeleteButton=function(){var e=this;this._container.children[0].addEventListener("click",function(t){function s(t){this.parentNode.removeChild(this),e._itemSelected="undefined",e._container.activate(!0)}e._buttonStyle(e._buttonDelete,"disabled");var n=e._itemSelected.getElementsByTagName("td"),r=[];for(var i=1;i<n.length;i++)r.push(n[i].innerHTML);r.push(e._container._lastIndex),e.removeRow(r),e._itemSelected.style.WebkitTransition="all 0.2s",e._itemSelected.style.MozTransition="all 0.2s",e._itemSelected.style.MsTransition="all 0.2s",e._itemSelected.style.OTransition="all 0.2s",e._itemSelected.style.transition="all 0.2s",e._itemSelected.style.opacity="0",e._itemSelected.addEventListener("transitionend",s,!1),e._itemSelected.addEventListener("mozTransitionEnd",s,!1),e._itemSelected.addEventListener("webkitTransitionEnd",s,!1)}),this._container.children[1].addEventListener("click",function(t){e._buttonStyle(e._buttonDelete,"disabled"),e._itemSelected.removeChild(e._container),e._itemSelected.innerHTML+="<td>"+e._container._lastIndex+"</td>",setTimeout(function(){e._itemSelected.setAttribute("data-select","false"),e._itemSelected="undefined",e._container.activate(!0)},200)}),this._buttonDelete.addEventListener("click",function(t){this.setAttribute("disabled","true"),e._buttonStyle(e._buttonEdit,"disabled");var n=e._itemSelected.children,r=[];for(var i=0;i<n.length;i++){var s=n[i].innerHTML;r.push(s)}e._nav.style.visibility="hidden",e._buttonStyle(e._showSearch,"disabled"),e._buttonStyle(e._addButton,"disabled"),e._status="busy";for(var i=0;i<e._tbody.children.length;i++)e._tbody.children[i]!=e._itemSelected&&(e._tbody.children[i].style.opacity="0.4",e._tbody.children[i].style.backgroundColor="#F4F4F4",e._tbody.children[i].style.cursor="none");e._itemSelected.style.cursor="default",e._container.children[0].style.height=e._itemSelected.clientHeight+"px",e._container.children[1].style.height=e._itemSelected.clientHeight+"px",e._container._lastIndex=e._itemSelected.children[e._itemSelected.children.length-1].innerHTML,e._itemSelected.removeChild(e._itemSelected.children[e._itemSelected.children.length-1]),e._itemSelected.insertBefore(e._container,e._itemSelected.children[0])})},Tablefy.prototype._buttonStyle=function(e,t){e&&(t=="enabled"?e.removeAttribute("disabled"):t=="disabled"&&e.setAttribute("disabled","true"))},Tablefy.prototype.addRow=function(e,t){this._dataSource.push(e),this._pages[this._currentPage].push(e);if(typeof t=="undefined"){var n=document.createElement("tr");this._tbody.appendChild(n);var r;for(var i=0;i<e.length;i++)r=document.createElement("td"),r.innerHTML=e[i],n.appendChild(r)}for(var s in this._buttonAddListener)this._buttonAddListener[s](e)},Tablefy.prototype.removeRow=function(e){var t=e.join(" ").trim(),n=-1;for(var r in this._dataSource){var i=this._dataSource[r].join(" ").trim();if(i==t){n=r;break}}var s=-1;for(var r in this._pages[this._currentPage]){var i=this._pages[this._currentPage][r].join(" ").trim();if(i==t){s=r;break}}this._dataSource.splice(n,1),this._pages[this._currentPage].splice(s,1);for(var o in this._buttonRemoveListener)this._buttonRemoveListener[o](e)},Tablefy.prototype._sarch=function(e){this._fixIconSort(),this._itemSelected="undefined",e=e.trim().toLowerCase();var t=[],n=e.split(" "),r="",i="(",s,o=!1;for(var u=0,s=n.length-1;u<n.length&&n.length>1;u++,s--)i+=n[s]+" ",o=!0;var a="("+e+")"+"|"+i.trim(i)+")",f;o?f=new RegExp(a,"i"):f=new RegExp(e,"i");for(var u in this._dataSource){var l=this._dataSource[u].join(" ");l.match(f)!=null&&t.push(this._dataSource[u])}t.length>0?(this._setData(t),this.sort("asc",0)):this._dataSource.length!=this._data.length&&this._setData(this._dataSource)},Tablefy.prototype.sort=function(e,t){this._data.sort(function(n,r){return e=="asc"?r[t]>n[t]?-1:r[t]<n[t]?1:0:n[t]>r[t]?-1:n[t]<r[t]?1:0}),this._setData(this._data)},Tablefy.prototype._sort=function(e,t){if(e=="asc"){var n=!0,r=t.length-2;while(n){n=!1;for(var i=0;i<=r;i++)if(t[i]>t[i+1]){var s=t[i];t[i]=t[i+1],t[i+1]=s,n=!0}}}},Tablefy.prototype._fixIconSort=function(){var e=this._element.getElementsByTagName("thead")[0].getElementsByTagName("span");for(var t=1;t<e.length;t+=2){var n=e[t];n.className="glyphicon glyphicon-sort",n.style.color=""}},Tablefy.prototype.addEventListener=function(e,t){if(e=="onEditRow")this._buttonEditListener.push(t);else if(e=="onAddRow")this._buttonAddListener.push(t);else if(e=="onRemoveRow")this._buttonRemoveListener.push(t);else if(e=="onClickRow"||e=="ondblClickRow"){this._listener.push({type:e,fn:t});var n=this;for(var r in this._listener)this._tbody.__type=this._listener[r].type=="onClickRow"?"click":"dblclick",this._tbody.__fn=this._listener[r].fn,this._tbody.addEventListener(this._tbody.__type,function(e){if(n._status=="free"){var t=e.target.parentNode.children,r=[];for(var i=0;i<t.length;i++)r.push(t[i].innerHTML);this.__fn(r)}})}},Tablefy.prototype.setDataTable=function(e){this._data=e,this._dataSource=e,this.length=e,this.sort("asc",0)},Tablefy.prototype._showPage=function(e){this._tbody.innerHTML="",this._currentPage=parseInt(e);var t=this._currentPage-1,n=this._pages[e];this._buttonStyle(this._buttonEdit,"disabled"),this._buttonStyle(this._buttonDelete,"disabled");for(var r in n){var i=document.createElement("tr");i.style.cursor="pointer";for(var s in n[r])td=document.createElement("td"),td.innerHTML=n[r][s],i.appendChild(td);this._tbody.appendChild(i)}},Tablefy.prototype._showPagination=function(e,t,n,r){var i=this._nav.children[0];i.innerHTML="";var s=document.createElement("li"),o=t-10;e!=1?s.innerHTML='<a href="#" data-direction="previus" data-page="'+o+'" aria-label="Previus"><span data-direction="previus" data-page="'+o+'" class="glyphicon glyphicon-backward" aria-hidden="true"></span></a>':(s.innerHTML='<a href="#" aria-label="Previus"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a>',s.className="disabled"),i.appendChild(s);var u=!1,a=this._data.length/this.maxElement;t>=a&&(t=Math.ceil(a),u=!0),t-e<10&&(e=t-9>=1?t-9:1);for(var f=e;f<=t;f++)s=document.createElement("li"),f==this._currentPage&&(s.className="active"),s.innerHTML='<a href="#" data-page="'+f+'">'+f+"</a>",i.appendChild(s);s=document.createElement("li"),u?(s.innerHTML='<a href="#"  aria-label="Next"><span class="glyphicon glyphicon-forward" aria-hidden="true"></span></a>',s.className="disabled"):s.innerHTML='<a href="#" data-direction="next" data-page="'+(t+1)+'" aria-label="Next"><span data-direction="next" data-page="'+(t+1)+'" class="glyphicon glyphicon-forward" aria-hidden="true"></span></a>',i.appendChild(s)},Tablefy.prototype._setData=function(e){this._pagination&&(this._element.parentNode.removeChild(this._nav),this._nav.children[0].innerHTML=""),this._data=e,this._pagination=!1;var t=1,n=1,r=this,i=!1;delete this._pages,this._pages={},this._pages[n]=[];var s=this._data.length/this.maxElement;for(var o in this._data)this._pages[n].push(this._data[o]),t==this.maxElement&&(t=0,n<s&&(n++,this._pages[n]=[],this._pagination=!0)),t++;this._showPage(1),this._pagination&&(this._showPagination(1,10),this._element.parentNode.appendChild(this._nav))},Tablefy.prototype.ajax=function(e,t){var n=new XMLHttpRequest;n.onload=function(t){if(this.status!==200)return e("Connection Problem !!!"),console.error("RESOURCE NOT FOUND !!!"),"";e(this.responseText)},n.onerror=function(t){e("Connection Problem !!!")};var r=[];for(var i in t.data)r.push(i+"="+t.data[i]);n.open("POST",t.url,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(r.join("&").trim())};